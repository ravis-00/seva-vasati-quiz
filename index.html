<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seva Vasati - Process Awareness Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .quiz-option:hover {
            background-color: #f0f9ff; /* light blue on hover */
        }
        .quiz-option input:checked + label {
            background-color: #e0f2fe; /* slightly darker blue when selected */
            border-color: #0284c7;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div id="quiz-container" class="w-full max-w-3xl mx-auto">

        <!-- Start Screen -->
        <div id="start-screen" class="bg-white p-8 rounded-xl shadow-lg text-center">
            <h1 id="quiz-title" class="text-3xl font-bold text-slate-800 mb-4"></h1>
            <p class="text-slate-600 mb-6">This test consists of <span id="question-count-info"></span> randomly selected questions to assess your process awareness.</p>
            <p class="text-slate-600 mb-8">Click the button below to begin.</p>
            <button onclick="startQuiz()" class="bg-sky-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-sky-700 transition-colors duration-300 shadow-md">
                Start Test
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h2 id="quiz-header" class="text-2xl font-bold text-slate-800 mb-6 border-b pb-4"></h2>
                <div id="questions-wrapper" class="space-y-8">
                    <!-- Questions will be dynamically inserted here -->
                </div>
                <div class="mt-8 text-center">
                    <button onclick="submitQuiz()" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors duration-300 shadow-md">
                        Submit Answers
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h2 class="text-3xl font-bold text-slate-800 mb-4">Test Complete!</h2>
                <p id="result-quiz-title" class="text-slate-600 mb-2"></p>
                <p class="text-2xl font-semibold text-slate-700 mt-6 mb-2">Your Score:</p>
                <p id="score-text" class="text-5xl font-bold text-sky-600 mb-8">0 / 0</p>
                <div id="feedback-text" class="text-slate-600 mb-8"></div>
                <button onclick="restartQuiz()" class="bg-sky-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-sky-700 transition-colors duration-300 shadow-md">
                    Take This Test Again
                </button>
            </div>
        </div>
    </div>

    <!-- External script for question banks -->
    <script src="questions.js"></script>

    <script>
        // --- PILOT CONFIGURATION ---
        // This is set to the Seva Vasati project for the pilot.
        const PILOT_PROJECT_KEY = "seva_vasati"; 
        
        const NUMBER_OF_QUESTIONS_TO_SELECT = 5;

        // The 'projectQuizzes' object is loaded from questions.js

        let selectedQuestions = [];
        let currentProjectKey = PILOT_PROJECT_KEY;

        // --- DOM ELEMENTS ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        
        /**
         * Initializes the application for the pilot project.
         */
        function initialize() {
            // Check if question bank was loaded
            if (typeof projectQuizzes === 'undefined' || !projectQuizzes[currentProjectKey]) {
                document.body.innerHTML = `<div class="w-full max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg text-center">
                    <h1 class="text-2xl font-bold text-red-600">Configuration Error</h1>
                    <p class="text-slate-600 mt-4">Could not load the question bank. Ensure <strong>questions.js</strong> is in the same folder and the project key "<strong>${currentProjectKey}</strong>" is correct.</p>
                    </div>`;
                return;
            }
            showStartScreen();
        }

        /**
         * Sets up and displays the start screen for the selected quiz.
         */
        function showStartScreen() {
            const project = projectQuizzes[currentProjectKey];
            document.getElementById('quiz-title').textContent = project.title;
            document.getElementById('question-count-info').textContent = Math.min(NUMBER_OF_QUESTIONS_TO_SELECT, project.questions.length);
            
            startScreen.classList.remove('hidden');
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
        }

        /**
         * Starts the quiz for the current project.
         */
        function startQuiz() {
            buildQuiz();
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
        }

        /**
         * Builds the quiz with questions from the current project's bank.
         */
        function buildQuiz() {
            const project = projectQuizzes[currentProjectKey];
            const questionBank = project.questions;
            
            document.getElementById('quiz-header').textContent = project.title;
            const questionsWrapper = document.getElementById('questions-wrapper');
            questionsWrapper.innerHTML = '';
            
            const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
            selectedQuestions = shuffled.slice(0, Math.min(NUMBER_OF_QUESTIONS_TO_SELECT, questionBank.length));

            selectedQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                const questionTitle = document.createElement('h3');
                questionTitle.className = 'text-lg font-semibold text-slate-700 mb-4';
                questionTitle.textContent = `${index + 1}. ${q.question}`;
                questionDiv.appendChild(questionTitle);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-3';
                const shuffledChoices = [...q.choices].sort(() => 0.5 - Math.random());

                shuffledChoices.forEach((choice, choiceIndex) => {
                    const optionWrapper = document.createElement('div');
                    optionWrapper.className = 'quiz-option';
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `question-${index}`;
                    input.value = choice;
                    input.id = `q${index}-option${choiceIndex}`;
                    input.className = 'sr-only';
                    const label = document.createElement('label');
                    label.htmlFor = `q${index}-option${choiceIndex}`;
                    label.textContent = choice;
                    label.className = 'block w-full p-4 border-2 border-slate-200 rounded-lg cursor-pointer transition-colors duration-200';
                    optionWrapper.appendChild(input);
                    optionWrapper.appendChild(label);
                    optionsDiv.appendChild(optionWrapper);
                });

                questionDiv.appendChild(optionsDiv);
                questionsWrapper.appendChild(questionDiv);
            });
        }

        /**
         * Submits the quiz and displays the result screen.
         */
        function submitQuiz() {
            let score = 0;
            selectedQuestions.forEach((q, index) => {
                const selectedOption = document.querySelector(`input[name="question-${index}"]:checked`);
                if (selectedOption && selectedOption.value === q.answer) {
                    score++;
                }
            });

            document.getElementById('score-text').textContent = `${score} / ${selectedQuestions.length}`;
            document.getElementById('result-quiz-title').textContent = projectQuizzes[currentProjectKey].title;
            
            const feedbackText = document.getElementById('feedback-text');
            const percentage = (score / selectedQuestions.length) * 100;
             if (percentage >= 80) {
                feedbackText.textContent = "Excellent! You have a strong understanding of our processes.";
                feedbackText.className = "text-green-600 font-medium";
            } else if (percentage >= 60) {
                feedbackText.textContent = "Good job! There are a few areas for review.";
                feedbackText.className = "text-yellow-600 font-medium";
            } else {
                feedbackText.textContent = "It looks like a review of the processes is needed. Please reach out to your manager for clarification.";
                feedbackText.className = "text-red-600 font-medium";
            }

            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
        }

        /**
         * Restarts the current quiz.
         */
        function restartQuiz() {
            resultScreen.classList.add('hidden');
            showStartScreen();
        }
        
        // Run initialization on page load
        initialize();
    </script>
</body>
</html>
